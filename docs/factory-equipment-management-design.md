# 工場設備管理アプリ プロトタイプ設計書

## 1. プロジェクト概要

### 1.1 プロジェクトの目的
この工場設備管理アプリは、工場内の設備の稼働状況やメンテナンス情報を一元管理し、効率的な運用をサポートすることを目的としています。

### 1.2 主要機能
- **設備の稼働状況のリアルタイム監視**: センサーを活用して、設備の稼働状況をリアルタイムで監視
- **メンテナンス管理**: 設備のメンテナンススケジュールを管理し、予防保全を実現
- **データ分析**: 設備の稼働データを分析し、効率的な運用方法を提案

### 1.3 期待される成果
- 設備の稼働状況をリアルタイムで把握することで、ダウンタイムを削減
- メンテナンスの効率化により、設備の寿命を延長
- データに基づいた運用改善提案により、生産性を向上

## 2. システム アーキテクチャ

### 2.1 使用技術スタック
- **Azure Functions**: データの処理や分析
- **Azure SQL Database**: 構造化データの保存（設備情報、メンテナンス履歴等）
- **Azure Cosmos DB**: IoTデバイスからのデータをリアルタイムで処理
- **Power BI**: データの可視化と分析結果の共有
- **Azure IoT Hub**: IoTデバイスとの通信
- **Azure Event Hubs**: ストリーミングデータの取り込み
- **Azure Storage Account**: ファイルやログの保存

### 2.2 システム構成図
```
[IoTセンサー] -> [Azure IoT Hub] -> [Azure Event Hubs] -> [Azure Functions]
                                                             |
[Power BI] <- [Azure SQL Database] <- [Azure Functions] -> [Azure Cosmos DB]
                                                             |
                                                      [Azure Storage]
```

### 2.3 データフロー
1. IoTセンサーから設備の稼働データを収集
2. Azure IoT Hubでデータを受信
3. Azure Event Hubsでストリーミングデータを処理
4. Azure Functionsでデータを処理・変換
5. リアルタイムデータはAzure Cosmos DBに保存
6. 履歴データはAzure SQL Databaseに保存
7. Power BIでダッシュボードを作成し、データを可視化

## 3. データモデル設計

### 3.1 設備マスタ（Azure SQL Database）
- 設備ID（主キー）
- 設備名
- 設備タイプ
- 設置場所
- 導入日
- メーカー
- モデル番号
- 最大稼働時間
- メンテナンス周期

### 3.2 センサーデータ（Azure Cosmos DB）
- データID（主キー）
- 設備ID
- センサータイプ
- 測定値
- 測定単位
- タイムスタンプ
- ステータス（正常/警告/異常）

### 3.3 メンテナンス履歴（Azure SQL Database）
- メンテナンスID（主キー）
- 設備ID
- メンテナンス種別
- 実施日時
- 担当者
- 作業内容
- 部品交換情報
- コスト
- 次回予定日

### 3.4 アラート情報（Azure Cosmos DB）
- アラートID（主キー）
- 設備ID
- アラートタイプ
- 重要度
- 発生日時
- 詳細メッセージ
- 対応状況

## 4. 機能要件

### 4.1 リアルタイム監視機能
- 設備の稼働状況をリアルタイムで表示
- 異常値検知時の自動アラート
- 設備の稼働率計算
- ダッシュボードでの一覧表示

### 4.2 メンテナンス管理機能
- メンテナンススケジュールの管理
- メンテナンス履歴の記録
- 予防保全の推奨
- 部品在庫管理

### 4.3 データ分析機能
- 稼働データの傾向分析
- 故障予測モデル
- 効率化提案
- レポート生成

### 4.4 アラート機能
- 閾値超過時の自動通知
- メンテナンス期限の事前通知
- 異常パターン検知
- メール・SMS通知

## 5. 非機能要件

### 5.1 パフォーマンス要件
- リアルタイムデータの処理遅延: 1秒以内
- 同時接続ユーザー数: 100ユーザー
- データ保存期間: 5年間
- ダッシュボード更新間隔: 5秒

### 5.2 可用性要件
- システム稼働率: 99.9%以上
- データバックアップ: 日次
- 災害復旧時間: 4時間以内

### 5.3 セキュリティ要件
- Azure Active Directoryによる認証
- RBAC（Role-Based Access Control）による権限管理
- データ暗号化（保存時・転送時）
- アクセスログの記録

### 5.4 スケーラビリティ要件
- 設備数: 最大1,000台
- センサー数: 設備あたり最大10個
- データ量: 月間10GB程度

## 6. 開発アプローチ

### 6.1 AI-Driven Development
- GitHub Copilotを活用したコード生成
- 自動テスト生成
- コードレビューの自動化
- ドキュメント生成の自動化

### 6.2 開発フェーズ
1. **フェーズ1**: 基盤構築（Azureリソースの構築）
2. **フェーズ2**: データ取り込み機能の開発
3. **フェーズ3**: リアルタイム監視機能の開発
4. **フェーズ4**: メンテナンス管理機能の開発
5. **フェーズ5**: データ分析・レポート機能の開発

### 6.3 テストデータ
本デモでは、以下の架空の工場設備データを使用します：
- 製造ライン A: 射出成形機 5台
- 製造ライン B: 組立ロボット 3台
- 製造ライン C: 検査装置 2台
- 共通設備: コンプレッサー 2台、冷却装置 1台

## 7. セキュリティ設計

### 7.1 認証・認可
- Azure Active Directory統合
- マルチファクタ認証（MFA）
- RBAC による細かい権限制御

### 7.2 データ保護
- Azure Key Vaultによる秘密情報管理
- データ暗号化（TLS 1.2以上）
- Azure SQL Database Transparent Data Encryption

### 7.3 ネットワークセキュリティ
- Azure Virtual Network
- Network Security Groups
- Azure Firewall

## 8. 運用・保守

### 8.1 監視
- Azure Monitor による システム監視
- Application Insights による アプリケーション監視
- Azure Log Analytics による ログ分析

### 8.2 バックアップ・復旧
- Azure SQL Database 自動バックアップ
- Azure Cosmos DB 継続的バックアップ
- 災害復旧計画（DRP）

### 8.3 コスト最適化
- Azure Cost Management による コスト監視
- 自動スケーリング設定
- 不要リソースの定期的な削除

## 9. 次のステップ

1. Azureリソースの構築
2. 開発環境のセットアップ
3. IoTシミュレーターの作成
4. 基本機能の実装
5. テスト・検証
6. 本格運用への移行計画